nginx_http_params:
  - access_log off
  - error_log /var/log/nginx/error.log
  - tcp_nopush on
  - tcp_nodelay on
  - keepalive_timeout 60
  - keepalive_requests 1000
  - access_log "/var/log/nginx/access.log"
nginx_sites:
  default:
    - listen 80 default_server
    - server_name _
    - return 301 https://$host$request_uri
  tracker:
    - server_name {{tracker_domain}}
    - listen 443 ssl http2
    - ssl_certificate_key /etc/letsencrypt/live/{{tracker_domain}}/privkey.pem
    - ssl_certificate     /etc/letsencrypt/live/{{tracker_domain}}/cert.pem
    - add_header 'Cache-Control' 'no-store, must-revalidate'
    - expires off
    - root {{alco_home_dir}}/alco-tracker/public
    - location / { try_files $uri $uri/index.html @node; }
    - location @node {
        proxy_redirect   off;
        proxy_buffering  off;
        proxy_set_header Host             $host;
        proxy_set_header X-Real-IP       $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_pass       http://alco-tracker;
      }
nginx_configs:
  gzip:
    - gzip on
    - gzip_min_length 10240
    - gzip_proxied expired no-cache no-store private auth
    - gzip_types text/plain text/css text/javascript application/javascript application/x-javascript
  upstream:
    - 'upstream alco-tracker { server {{alco_docker_ip}}:8081 weight=10; }'
